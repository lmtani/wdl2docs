{# Specific components for WDL document pages #}
{% from "macros/badges.html" import workflow_badge, task_badge, call_badge, external_badge %}
{% from "macros/tables.html" import inputs_table, outputs_table, runtime_table, imports_table, document_info_table %}
{% from "components/buttons.html" import graph_button, source_button, action_buttons %}
{# Workflow section header with action buttons #}
{% macro workflow_section_header(workflow_name, has_graph=false, has_source=false) %}
    <div style="display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px">
        <h2 style="margin: 0;">Workflow: {{ workflow_name }}</h2>
        {% call action_buttons() %}
            {% if has_graph %}{{ graph_button() }}{% endif %}
            {% if has_source %}{{ source_button() }}{% endif %}
        {% endcall %}
    </div>
{%- endmacro %}

{# Author and email info banner #}
{% macro author_info(author=none, email=none) %}
    {% if author or email %}
    <div style="margin: 12px 0;
                padding: 10px 14px;
                background: rgba(88, 166, 255, 0.08);
                border-radius: 6px;
                border-left: 3px solid #58a6ff;
                font-size: 14px;">
        <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
            {% if author %}
            <div style="display: flex; align-items: center; gap: 6px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span style="color: #c9d1d9;"><strong style="color: #58a6ff;">Author:</strong> {{ author }}</span>
            </div>
            {% endif %}
            {% if email %}
            <div style="display: flex; align-items: center; gap: 6px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                    <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                </svg>
                <a href="mailto:{{ email }}" style="color: #58a6ff; text-decoration: none;">{{ email }}</a>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
{%- endmacro %}
{# Tasks section header with action button #}
{% macro tasks_section_header(has_source=false) %}
    <div style="display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px">
        <h2 style="margin: 0;">Tasks</h2>
        {% if has_source %}{{ source_button() }}{% endif %}
    </div>
{%- endmacro %}
{# Banner showing subworkflow usage info #}
{% macro subworkflow_usage_banner(workflow_call_info, doc_relative_path) %}
    <div style="margin: 16px 0;
                padding: 12px;
                background: linear-gradient(135deg, #1f6feb 0%, #8b5cf6 100%);
                border-radius: 8px;
                border-left: 4px solid #a371f7">
        <div style="display: flex;
                    align-items: center;
                    gap: 8px;
                    margin-bottom: 8px">
            <svg width="20"
                 height="20"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 style="flex-shrink: 0">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <strong style="font-size: 14px;">Subworkflow Usage</strong>
        </div>
        <p style="margin: 0; font-size: 14px;">
            This workflow is called as a subworkflow by <strong>{{ workflow_call_info.count }}</strong> other workflow{{ 's' if workflow_call_info.count != 1 else '' }}:
        </p>
        <ul style="margin: 8px 0 0 0; padding-left: 20px; font-size: 13px;">
            {% for caller in workflow_call_info.workflows %}
                <li style="margin: 4px 0;">
                    <a href="{{ caller.url | relative_link(doc_relative_path) }}"
                       style="color: #ecf0f1;
                              text-decoration: underline">{{ caller.name }}</a>
                    <span style="opacity: 0.8;"> - <code style="background: rgba(0,0,0,0.2);
              padding: 2px 6px;
              border-radius: 3px;
              font-size: 12px">{{ caller.file_path }}</code></span>
                </li>
            {% endfor %}
        </ul>
    </div>
{%- endmacro %}
{# Call block (task or workflow call) #}
{% macro call_block(call, doc_relative_path) %}
    <div class="call-block">
        <h4>
            {{ call_badge() }}
            {% if call.is_workflow_call %}
                {{ workflow_badge() }}
            {% else %}
                {{ task_badge() }}
            {% endif %}
            {% if call.link_target %}
                {% if call.is_local %}
                    <a href="{{ call.link_target }}" class="call-link call-link-local">
                        <code>{{ call.display_name }}</code>
                    </a>
                {% else %}
                    <a href="{{ call.link_target | relative_link(doc_relative_path) }}#task-{{ call.task_or_workflow }}"
                       class="call-link call-link-external">
                        <code>{{ call.display_name }}</code>
                        <span class="external-icon" title="Opens in another page">‚Üó</span>
                    </a>
                {% endif %}
            {% else %}
                <code>{{ call.display_name }}</code>
            {% endif %}
            {% if call.alias %}<span class="call-target">‚Üí {{ call.task_or_workflow }}</span>{% endif %}
        </h4>
        {% if call.inputs_mapping %}
            <details>
                <summary>Input Mappings ({{ call.inputs_mapping|length }})</summary>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Input</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for key, value in call.inputs_mapping.items() %}
                                <tr>
                                    <td>
                                        <code>{{ key }}</code>
                                    </td>
                                    <td>
                                        <code>{{ value }}</code>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </details>
        {% else %}
            <p class="description" style="margin-top: 10px;">No explicit input mappings</p>
        {% endif %}
    </div>
{%- endmacro %}
{# Docker images grid #}
{% macro docker_images_grid(docker_images) %}
    <div class="docker-images-grid">
        {% for docker in docker_images %}
            <div class="docker-card {% if docker.is_parameterized %}docker-parameterized{% endif %}">
                <div class="docker-header">
                    <span class="docker-icon">üê≥</span>
                    {% if docker.is_parameterized %}
                        <strong>Parameterized Image</strong>
                    {% else %}
                        <strong>{{ docker.short_name }}</strong>
                    {% endif %}
                </div>
                <div class="docker-body">
                    {% if docker.is_parameterized %}
                        <div class="docker-badge docker-badge-param">
                            <span>‚öôÔ∏è Parameterized</span>
                        </div>
                        <p class="docker-image-text">
                            <small>Configured via input:</small>
                            <br>
                            <code>{{ docker.parameter_name or 'runtime parameter' }}</code>
                        </p>
                    {% else %}
                        <p class="docker-image-text">
                            <code>{{ docker.image }}</code>
                        </p>
                    {% endif %}
                    <div class="docker-tasks">
                        <strong>Used by {{ docker.task_count }} task{{ 's' if docker.task_count != 1 else '' }}:</strong>
                        <ul class="task-list">
                            {% for task_name in docker.task_names %}
                                <li>
                                    <code>{{ task_name }}</code>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{%- endmacro %}
{# Complete task card with all sections #}
{% macro task_card(task) %}
    <div class="card" id="task-{{ task.name }}" style="margin-bottom: 20px;">
        <h3>{{ task_badge() }} {{ task.name }}</h3>
        {% if task.description %}<p class="description">{{ task.description }}</p>{% endif %}
        {{ author_info(task.author, task.email) }}
        {% if task.has_inputs %}
            <h4>Inputs</h4>
            {{ inputs_table(task.inputs) }}
        {% endif %}
        {% if task.has_command %}
            <h4>Command</h4>
            <pre><code class="language-bash">{{ task.command.formatted_command }}</code></pre>
        {% endif %}
        {% if task.has_outputs %}
            <h4>Outputs</h4>
            {{ outputs_table(task.outputs) }}
        {% endif %}
        {% if task.has_runtime %}
            <h4>Runtime</h4>
            {{ runtime_table(task.runtime) }}
        {% endif %}
    </div>
{%- endmacro %}
